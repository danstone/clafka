<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>clafka.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Clafka 0.2.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clafka</span></div></div></li><li class="depth-2 branch current"><a href="clafka.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="clafka.pool.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pool</span></div></a></li><li class="depth-2 branch"><a href="clafka.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="clafka.sim.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sim</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="clafka.core.html#var-*default-buffer-size*"><div class="inner"><span>*default-buffer-size*</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-*default-fetch-size*"><div class="inner"><span>*default-fetch-size*</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-*default-poll-ms*"><div class="inner"><span>*default-poll-ms*</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-*default-socket-timeout*"><div class="inner"><span>*default-socket-timeout*</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-block"><div class="inner"><span>block</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-broker-.3Emap"><div class="inner"><span>broker-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-consumer"><div class="inner"><span>consumer</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-earliest-offset"><div class="inner"><span>earliest-offset</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-earliest-time"><div class="inner"><span>earliest-time</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-error-code-.3Ekw"><div class="inner"><span>error-code-&gt;kw</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-fetch"><div class="inner"><span>fetch</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-fetch-log"><div class="inner"><span>fetch-log</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-fetch-request"><div class="inner"><span>fetch-request</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-fetch-response-.3Emap"><div class="inner"><span>fetch-response-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-find-leader"><div class="inner"><span>find-leader</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-find-leaders"><div class="inner"><span>find-leaders</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-fn-.3Ecallback"><div class="inner"><span>fn-&gt;callback</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-kafka-serializer"><div class="inner"><span>kafka-serializer</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-latest-offset"><div class="inner"><span>latest-offset</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-latest-time"><div class="inner"><span>latest-time</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-log-head.3F"><div class="inner"><span>log-head?</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-log-seq"><div class="inner"><span>log-seq</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-message-and-offset-.3Emap"><div class="inner"><span>message-and-offset-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-next-block-offset"><div class="inner"><span>next-block-offset</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-offset-at"><div class="inner"><span>offset-at</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-offset-request"><div class="inner"><span>offset-request</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-offsets"><div class="inner"><span>offsets</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-partition-metadata-.3Emap"><div class="inner"><span>partition-metadata-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-poll-from-offset"><div class="inner"><span>poll-from-offset</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-producer"><div class="inner"><span>producer</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-producer-record"><div class="inner"><span>producer-record</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-publish.21"><div class="inner"><span>publish!</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-publish-ack.21"><div class="inner"><span>publish-ack!</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-record-metadata-.3Emap"><div class="inner"><span>record-metadata-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-serialize-default"><div class="inner"><span>serialize-default</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-topic-metadata-.3Emap"><div class="inner"><span>topic-metadata-&gt;map</span></div></a></li><li class="depth-1"><a href="clafka.core.html#var-topic-metadata-request"><div class="inner"><span>topic-metadata-request</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">clafka.core</h2><div class="doc"><div class="markdown"><p>Contains a clojure interface for the Producer and SimpleConsumer api&rsquo;s</p></div></div><div class="public anchor" id="var-*default-buffer-size*"><h3>*default-buffer-size*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L82">view source</a></div></div><div class="public anchor" id="var-*default-fetch-size*"><h3>*default-fetch-size*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L302">view source</a></div></div><div class="public anchor" id="var-*default-poll-ms*"><h3>*default-poll-ms*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L358">view source</a></div></div><div class="public anchor" id="var-*default-socket-timeout*"><h3>*default-socket-timeout*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L81">view source</a></div></div><div class="public anchor" id="var-block"><h3>block</h3><div class="usage"><code>(block topic partition offset size)</code></div><div class="doc"><div class="markdown"><p>Returns a map describing a block of data in a kafka log</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L178">view source</a></div></div><div class="public anchor" id="var-broker-.3Emap"><h3>broker-&gt;map</h3><div class="usage"><code>(broker-&gt;map broker)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L104">view source</a></div></div><div class="public anchor" id="var-consumer"><h3>consumer</h3><div class="usage"><code>(consumer host port)</code><code>(consumer host port client-id)</code><code>(consumer host port client-id socket-timeout buffer-size)</code></div><div class="doc"><div class="markdown"><p>Creates a SimpleConsumer instance in order to 1. Query topic metadata with <code>topic-metadata-request</code> 2. Query leadership status with <code>find-leader</code> and <code>find-leaders</code> 3. Fetch data with <code>fetch</code>, <code>fetch-log</code> and <code>log-seq</code> 4. Make offset metadata requests with <code>offsets</code> or <code>offset-at</code></p><p>The consumer maintains a tcp connection internally and can be closed with <code>.close</code> - be warned, there appears to be a bug in kafka 0.8.2 whereby this connection is re-opened if you use the consumer again, subsequent .close calls should close it again.</p><p>The connection is automatically reconnected if the socket is closed/timed out however, while it is unavailable some operations will return ClosedChannelExceptions</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L84">view source</a></div></div><div class="public anchor" id="var-earliest-offset"><h3>earliest-offset</h3><div class="usage"><code>(earliest-offset client topic partition)</code></div><div class="doc"><div class="markdown"><p>Finds the earliest offset in the log</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L291">view source</a></div></div><div class="public anchor" id="var-earliest-time"><h3>earliest-time</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A constant that can be used as a <code>time</code> value for offset requests via <code>offsets</code> representing the beginning of the log</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L131">view source</a></div></div><div class="public anchor" id="var-error-code-.3Ekw"><h3>error-code-&gt;kw</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Maps Kafka error codes to keywords</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L143">view source</a></div></div><div class="public anchor" id="var-fetch"><h3>fetch</h3><div class="usage"><code>(fetch client topic partition offset)</code><code>(fetch client topic partition offset size)</code></div><div class="doc"><div class="markdown"><p>Fetches a single block of data from kafka, throws exceptions for broker errors</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L304">view source</a></div></div><div class="public anchor" id="var-fetch-log"><h3>fetch-log</h3><div class="usage"><code>(fetch-log client topic partition offset)</code><code>(fetch-log client topic partition offset size)</code></div><div class="doc"><div class="markdown"><p>Fetch the entire log from the given offset, lazily fetches in batches of <code>size</code> bytes (default 512KB). Returns a seq of messages. Messages greater in size than <code>size</code> in total will be omitted</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L329">view source</a></div></div><div class="public anchor" id="var-fetch-request"><h3>fetch-request</h3><div class="usage"><code>(fetch-request consumer blocks)</code></div><div class="doc"><div class="markdown"><p>Requests the consumer to fetch blocks of data from kafka the blocks are described by maps in the <code>blocks</code> collection, each block is simply a map of :topic, :partition, :offset and :size</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L219">view source</a></div></div><div class="public anchor" id="var-fetch-response-.3Emap"><h3>fetch-response-&gt;map</h3><div class="usage"><code>(fetch-response-&gt;map fetch-response blocks)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L198">view source</a></div></div><div class="public anchor" id="var-find-leader"><h3>find-leader</h3><div class="usage"><code>(find-leader client topic partition)</code></div><div class="doc"><div class="markdown"><p>Finds the leader for the given topic partition</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L260">view source</a></div></div><div class="public anchor" id="var-find-leaders"><h3>find-leaders</h3><div class="usage"><code>(find-leaders client topics)</code></div><div class="doc"><div class="markdown"><p>Finds partition leaders for the given topics</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L254">view source</a></div></div><div class="public anchor" id="var-fn-.3Ecallback"><h3>fn-&gt;callback</h3><div class="usage"><code>(fn-&gt;callback f)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L63">view source</a></div></div><div class="public anchor" id="var-kafka-serializer"><h3>kafka-serializer</h3><div class="usage"><code>(kafka-serializer serializer)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L13">view source</a></div></div><div class="public anchor" id="var-latest-offset"><h3>latest-offset</h3><div class="usage"><code>(latest-offset client topic partition)</code></div><div class="doc"><div class="markdown"><p>Finds the latest offset in the log</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L296">view source</a></div></div><div class="public anchor" id="var-latest-time"><h3>latest-time</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A constant that can be used as a <code>time</code> value for offset requests via <code>offsets</code> representing the head of the log</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L137">view source</a></div></div><div class="public anchor" id="var-log-head.3F"><h3>log-head?</h3><div class="usage"><code>(log-head? block)</code></div><div class="doc"><div class="markdown"><p>Are we at the log head?</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L315">view source</a></div></div><div class="public anchor" id="var-log-seq"><h3>log-seq</h3><div class="usage"><code>(log-seq client topic partition offset)</code><code>(log-seq client topic partition offset {:keys [size poll-ms], :or {size *default-fetch-size*, poll-ms *default-poll-ms*}, :as opts})</code></div><div class="doc"><div class="markdown"><p>Returns an infinite seq of messages from offset, requests blocks of data from kafka in blocks of <code>:size</code> (512KB by default) Messages greater in size than <code>:size</code> in total will be omitted once the log has been exhausted will enter a polling mode whereby it tries to retrieve new blocks every <code>:poll-ms</code> millis, (1000 by default)</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L360">view source</a></div></div><div class="public anchor" id="var-message-and-offset-.3Emap"><h3>message-and-offset-&gt;map</h3><div class="usage"><code>(message-and-offset-&gt;map mao)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L186">view source</a></div></div><div class="public anchor" id="var-next-block-offset"><h3>next-block-offset</h3><div class="usage"><code>(next-block-offset block)</code></div><div class="doc"><div class="markdown"><p>Find the starting offset from the block if possible (nil if not)</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L324">view source</a></div></div><div class="public anchor" id="var-offset-at"><h3>offset-at</h3><div class="usage"><code>(offset-at client topic partition time)</code></div><div class="doc"><div class="markdown"><p>Makes a request to find the offset for time <code>time</code> in the log given by the <code>topic</code> and <code>partition</code> - you can use the 2 special constants <code>earliest-time</code> and <code>latest-time</code> to ask for the earliest or latest offset</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L283">view source</a></div></div><div class="public anchor" id="var-offset-request"><h3>offset-request</h3><div class="usage"><code>(offset-request m time client-id)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L169">view source</a></div></div><div class="public anchor" id="var-offsets"><h3>offsets</h3><div class="usage"><code>(offsets client m time)</code></div><div class="doc"><div class="markdown"><p>Make an offset request to determine the offset at <code>time</code> in the log time is a long value or one of the 2 special constants <code>earliest-time</code> or <code>latest-time</code>. m is a map of {topic [partition]} you will receive back a map  of {topic [{:offset, :partition}]}</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L269">view source</a></div></div><div class="public anchor" id="var-partition-metadata-.3Emap"><h3>partition-metadata-&gt;map</h3><div class="usage"><code>(partition-metadata-&gt;map partition-metadata)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L111">view source</a></div></div><div class="public anchor" id="var-poll-from-offset"><h3>poll-from-offset</h3><div class="usage"><code>(poll-from-offset client topic partition offset size poll-ms)</code></div><div class="doc"><div class="markdown"><p>Fetches a block of data from the kafka log, unless the offset is at the head of the log, in which case it will wait and poll until a block can be received every <code>poll-ms</code></p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L347">view source</a></div></div><div class="public anchor" id="var-producer"><h3>producer</h3><div class="usage"><code>(producer config)</code><code>(producer config serializer)</code><code>(producer config key-serializer value-serializer)</code></div><div class="doc"><div class="markdown"><p>Pass in a config map for the producer <a href="http://kafka.apache.org/documentation.html#newproducerconfigs">docs</a> and a serializer that takes the topic name and a value, and is expected to return a byte array.</p><p>n.b <code>serialize-default</code> can be overridden per topic to specify global serialization behaviour</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L27">view source</a></div></div><div class="public anchor" id="var-producer-record"><h3>producer-record</h3><div class="usage"><code>(producer-record topic k v)</code></div><div class="doc"><div class="markdown"><p>Creates a keyed message for the given topic</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L42">view source</a></div></div><div class="public anchor" id="var-publish.21"><h3>publish!</h3><div class="usage"><code>(publish! producer producer-record)</code><code>(publish! producer topic k v)</code></div><div class="doc"><div class="markdown"><p>Sends a message asynchronously via &lsquo;producer&rsquo;, returns a delay that will contain metadata about what has been sent. The key and value ought to be compatible with the serializer used by the producer.</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L53">view source</a></div></div><div class="public anchor" id="var-publish-ack.21"><h3>publish-ack!</h3><div class="usage"><code>(publish-ack! producer producer-record f)</code><code>(publish-ack! producer topic k v f)</code></div><div class="doc"><div class="markdown"><p>Sends a message asynchronously via &lsquo;producer&rsquo;, returns a delay that will contain metadata about what has been sent. Accepts a function <code>f</code> that will be called when the broker has acknowledged receipt of the message. The precise acknowledgment semantics will depend on your producer&rsquo;s <code>acks</code> setting.</p></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L70">view source</a></div></div><div class="public anchor" id="var-record-metadata-.3Emap"><h3>record-metadata-&gt;map</h3><div class="usage"><code>(record-metadata-&gt;map rm)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L47">view source</a></div></div><div class="public anchor" id="var-serialize-default"><h3>serialize-default</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L21">view source</a></div></div><div class="public anchor" id="var-topic-metadata-.3Emap"><h3>topic-metadata-&gt;map</h3><div class="usage"><code>(topic-metadata-&gt;map topic-metadata)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L119">view source</a></div></div><div class="public anchor" id="var-topic-metadata-request"><h3>topic-metadata-request</h3><div class="usage"><code>(topic-metadata-request consumer topics)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/mixradio/clafka/blob/master/src/clafka/core.clj#L125">view source</a></div></div></div></body></html>